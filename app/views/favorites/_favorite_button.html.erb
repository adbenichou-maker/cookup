<% favorite = current_user ? current_user.favorites.find_by(recipe_id: recipe.id) : nil %>
<% refresh_on_remove = local_assigns[:refresh_on_remove] || false %>

<div id="<%= dom_id(recipe, :favorite_button) %>">
  <% if current_user %>
    <% if favorite %>

      <%= button_to favorite_path(favorite),
          method: :delete,
          class: "favorite-btn saved" ,
          form: { data: { turbo: !refresh_on_remove }, class: "favorite-form" } do %>
        <i class="fa-solid fa-heart"></i>
      <% end %>

    <% else %>

      <%= form_with url: favorites_path,
          method: :post,
          data: { turbo: true },
          html: { class: "favorite-form" } do |f| %>

        <%= hidden_field_tag :recipe_id, recipe.id %>

        <%= f.button type: "submit", class: "favorite-btn unsaved" do %>
          <i class="fa-regular fa-heart"></i>
        <% end %>

      <% end %>

    <% end %>
  <% else %>

    <%= link_to new_user_session_path, class: "favorite-btn unsaved" do %>
      <i class="fa-regular fa-heart"></i>
    <% end %>

  <% end %>
</div>
