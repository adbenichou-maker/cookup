<div class="offcanvas offcanvas-end sidebar bg-beige text-charcoal" tabindex="-1" id="chatsOffcanvas" aria-labelledby="chatsOffcanvasLabel">
  <div class="offcanvas-header pb-0 border-bottom border-light">
    <div class="d-flex align-items-center">
      <%= link_to root_path, class: "me-2" do %>
        <%# Icon/Logo using Clean Charcoal for text/icons #4A4A4A %>
        <i class="fa-solid fa-hat-chef fa-2x text-charcoal"></i>
      <% end %>
      <h5 class="offcanvas-title fw-bold text-charcoal" id="chatsOffcanvasLabel">Recent AI Chats</h5>
    </div>
    <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
  </div>

  <div class="offcanvas-body pt-2">
    <% if user_signed_in? %>
      <div class="d-grid gap-2 mb-4">
        <%# Button styled using the Accent Green #8BAA7B %>
        <%= link_to "Start a New Chat", new_chat_path, class: "btn btn-accent-green" %>
      </div>

      <h6 class="text-uppercase text-charcoal opacity-75 mb-2">History</h6>

      <div class="chat-list">
        <% chats = current_user.chats.order(updated_at: :desc) %>

        <% if chats.any? %>
          <% chats.each do |chat| %>
            <% active_class = (defined?(@chat) && @chat == chat) ? 'bg-soft-brown-active text-white' : 'bg-soft-brown-hover' %>

            <%# Applying the chat-sidebar-link class ensures hover visibility %>
            <%= link_to chat_path(chat), class: "d-block p-2 text-decoration-none rounded-2 mb-2 text-charcoal #{active_class} chat-sidebar-link" do %>
              <div class="d-flex justify-content-between align-items-start">
                <%# Chat Title: Added text-truncate to prevent massive titles from pushing the badge too far, but kept max-width for wrapping shorter titles %>
                <span class="fw-medium me-2 text-truncate" style="white-space: normal; overflow-wrap: break-word; max-width: 75%;">
                  <%= chat.title %>
                </span>

                <%# ðŸ‘‡ Pill Badge for Time Elapsed %>
                <small class="badge rounded-pill badge-outline-charcoal text-charcoal opacity-75 flex-shrink-0 ms-1 p-2">
                  <%= time_ago_in_words(chat.updated_at) %> ago
                </small>
              </div>
            <% end %>
          <% end %>
        <% else %>
          <p class="text-charcoal opacity-75 text-center mt-3">You haven't started any chats yet!</p>
        <% end %>
      </div>

    <% else %>
      <p class="text-center text-charcoal">Please sign in to view your chat history.</p>
    <% end %>
  </div>
</div>
