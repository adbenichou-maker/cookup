<div class="container-fluid p-4 congrats-page" style="background-color: #F7EEDB; min-height: 100vh;">

  <% recipe_index = @recipe.recipe_level_before_type_cast %>
  <% total_levels = 3 %>
  <% progress_percent = ((recipe_index + 1).to_f / total_levels.to_f * 100).round %>

  <div class="d-flex justify-content-start mb-4">
    <%= link_to recipe_path(params[:id]), class: "profile-back" do %>
    <i class="fa-solid fa-arrow-left"></i>
    <% end %>
  </div>
    <header class="text-center mb-5 pt-3">
    <h1 class="fw-bolder mb-2" style="color: #4A4A4A;" >
      CONGRATULATIONS
    </h1>
    <p class="lead fw-normal" style="color: #4A4A4A;">
      You finished <%= @recipe.title %>!
    </p>
  </header>

  <section class="text-center mb-5"
          data-controller="xp-bar"
          data-xp-bar-old-value="<%= @old_xp_percent %>"
          data-xp-bar-new-value="<%= @new_xp_percent %>">

    <p class="fw-bold" style="color: #4A4A4A;">
      Level <%= current_user.level %> â€” <%= current_user.xp %>/<%= current_user.xp_required_for_current_level %> XP
    </p>

    <div class="progress-wrapper mx-auto" style="max-width: 350px;">
      <div class="progress-bar-fill"
          data-xp-bar-target="fill"
          style="width: <%= @old_xp_percent %>%;">
      </div>
    </div>
  </section>

  <div class="row justify-content-center">
    <div class="col-12 col-md-10">
      <!-- ADD REVIEW BUTTON -->
      <div class="congrats-btn-wrapper">
        <%= link_to "â­ï¸ ADD A REVIEW", new_recipe_review_path(@recipe),
          class: "congrats-btn" %>
      </div>

      <!-- SAVE / REMOVE BUTTON -->
      <div class="congrats-btn-wrapper">
        <div class="congrats-fav-wrapper">
          <%= render partial: "favorites/favorite_button", locals: { recipe: @recipe } %>
        </div>
      </div>


      <!-- GO HOME BUTTON -->
      <div class="congrats-btn-wrapper">
        <%= link_to "ðŸ  GO HOME", dashboard_path,
          class: "congrats-btn" %>
      </div>
    </div>
  </div>


  <% if @leveled_up %>
    <div data-controller="confetti"></div>
  <% end %>

</div>
