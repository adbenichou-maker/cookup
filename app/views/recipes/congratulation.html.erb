<% content_for :hide_navbar, true %>

<div class="congrats-page">
  <!-- Back Button -->
  <div class="congrats-back-wrapper">
    <%= link_to recipe_path(params[:id]), class: "congrats-back-btn" do %>
      <i class="fa-solid fa-arrow-left"></i>
    <% end %>
  </div>

  <!-- Hero Section with Trophy -->
  <section class="congrats-hero">
    <div class="congrats-trophy-wrapper">
      <div class="congrats-trophy">
        <i class="fa-solid fa-trophy"></i>
      </div>
      <div class="congrats-sparkles">
        <span class="sparkle sparkle-1">&#10022;</span>
        <span class="sparkle sparkle-2">&#10022;</span>
        <span class="sparkle sparkle-3">&#10022;</span>
        <span class="sparkle sparkle-4">&#10022;</span>
      </div>
    </div>

    <h1 class="congrats-title">Congratulations!</h1>
    <p class="congrats-subtitle">You finished <strong><%= @recipe.title %></strong></p>
  </section>

  <!-- XP Progress Card -->
  <section class="congrats-xp-card"
           data-controller="xp-bar"
           data-xp-bar-old-value="<%= @old_xp_percent %>"
           data-xp-bar-new-value="<%= @new_xp_percent %>">

    <div class="xp-card-header">
      <div class="xp-level-badge">
        <i class="fa-solid fa-award"></i>
        <span>Level <%= current_user.level %></span>
      </div>
      <% xp_earned = { 0 => 20, 1 => 40, 2 => 60 }[@recipe.recipe_level_before_type_cast] || 20 %>
      <span class="xp-earned-badge">+<%= xp_earned %> XP</span>
    </div>

    <div class="xp-progress-wrapper">
      <div class="xp-progress-fill"
           data-xp-bar-target="fill"
           style="width: <%= @old_xp_percent %>%;">
      </div>
    </div>

    <p class="xp-progress-text">
      <%= current_user.xp %> / <%= current_user.xp_required_for_current_level %> XP
    </p>
  </section>

  <!-- Action Buttons -->
  <section class="congrats-actions">
    <!-- Add Review -->
    <%= link_to new_recipe_review_path(@recipe), class: "congrats-action-card" do %>
      <div class="congrats-action-icon congrats-icon-star">
        <i class="fa-solid fa-star"></i>
      </div>
      <div class="congrats-action-label">
        <span class="congrats-action-title">Leave a Review</span>
        <span class="congrats-action-subtitle">Share your experience</span>
      </div>
      <i class="fa-solid fa-chevron-right congrats-action-arrow"></i>
    <% end %>

    <!-- Save to Cookbook -->
    <div class="congrats-cookbook-wrapper">
      <%= render partial: "favorites/favorite_button", locals: { recipe: @recipe } %>
    </div>

    <!-- Go Home -->
    <%= link_to dashboard_path, class: "congrats-action-card" do %>
      <div class="congrats-action-icon">
        <i class="fa-solid fa-house"></i>
      </div>
      <div class="congrats-action-label">
        <span class="congrats-action-title">Back to Home</span>
        <span class="congrats-action-subtitle">Explore more recipes</span>
      </div>
      <i class="fa-solid fa-chevron-right congrats-action-arrow"></i>
    <% end %>
  </section>

  <!-- Footer Logo -->
  <footer class="congrats-footer">
    <%= image_tag "logo_cookup.png", class: "congrats-footer-logo" %>
  </footer>

  <% if @leveled_up %>
    <div data-controller="confetti"></div>
  <% end %>
</div>
