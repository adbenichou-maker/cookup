<div class="chat-container"
    data-controller="autoscroll chat-typing"
    data-chat-typing-target="messages">

  <div id="messages" data-autoscroll-target="messages">
    <% @chat.messages.each do |message| %>

      <% if message.role == "user" %>
        <div class="message-row">
          <div class="chat-bubble chat-user">
            <%= message.content %>
          </div>
        </div>

      <% else %>
        <div class="message-row">
          <div class="chat-bubble chat-assistant">
            <%= raw(render_markdown(message.content)) %>
            <%= link_to "Save Recipe",
                message_recipes_path(message),
                data: { turbo_method: "post" },
                class: 'my-button' %>
          </div>
        </div>
      <% end %>

    <% end %>
  </div>

  <div id="typing-indicator" class="typing-indicator hidden">
    <div class="typing-dot"></div>
    <div class="typing-dot"></div>
    <div class="typing-dot"></div>
  </div>

  <%= simple_form_for [@chat, @message],
      html: {
        class: "chat-form",
        data: {
          controller: "sendbutton",
          action: "submit->sendbutton#submit submit->chat-typing#showTyping"
        }
      } do |f| %>

    <div class="chat-buttons-row">

      <%= f.button :submit, "Select Option 1",
          class: "chat-submit-btn",
          value: "Select Option 1",
          name: "message[content]" %>

      <%= f.button :submit, "Select Option 2",
          class: "chat-submit-btn",
          value: "Select Option 2",
          name: "message[content]" %>

      <%= f.button :submit, "Select Option 3",
          class: "chat-submit-btn",
          value: "Select Option 3",
          name: "message[content]" %>

      <%= f.button :submit, "Give me 3 more recipes",
          class: "chat-submit-btn big",
          name: "message[content]",
          value: "Give me 3 more recipes" %>

    </div>

  <% end %>

</div>
