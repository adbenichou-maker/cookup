<div class="ai-form-container">
  <a class="btn btn-accent-green" href="#" data-bs-toggle="offcanvas" data-bs-target="#chatsOffcanvas" aria-controls="chatsOffcanvas">
    <i class="fa-solid fa-bars me-2"></i>Chats
  </a>

  <h1 class="text-charcoal mt-4">What's Cooking?</h1>
  <p class="text-charcoal opacity-75">Tell your AI Chef about the dish you want to create.</p>

  <%= simple_form_for @chat, url: chats_path, method: :post do |f| %>

    <%= f.simple_fields_for :recipe_requirements, @recipe_requirements do |req| %>

      <div class="space-y-6">

        <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
          <%= req.input :ingredients,
              label: "Key Ingredients",
              input_html: { class: "form-control" },
              placeholder: "e.g., chicken, basil, tomatoes" %>
        </div>
        <div class="mb-4">
          <label class="form-label text-charcoal">Your Cooking Skill Level</label>

          <div class="btn-group w-100" role="group" aria-label="Skill level selection">
            <input type="radio" class="btn-check" name="chat[recipe_requirements][skill_level]" id="skill_beginner" value="Beginner" autocomplete="off" <%= 'checked' if @recipe_requirements[:skill_level] == 'Beginner' %>>
            <label class="btn btn-outline-soft-brown flex-grow-1" for="skill_beginner">Beginner</label>

            <%# Skill Level 2: Intermediate %>
            <input type="radio" class="btn-check" name="chat[recipe_requirements][skill_level]" id="skill_intermediate" value="Intermediate" autocomplete="off" <%= 'checked' if @recipe_requirements[:skill_level] == 'Intermediate' %>>
            <label class="btn btn-outline-soft-brown flex-grow-1" for="skill_intermediate">Intermediate</label>

            <%# Skill Level 3: Advanced %>
            <input type="radio" class="btn-check" name="chat[recipe_requirements][skill_level]" id="skill_advanced" value="Advanced" autocomplete="off" <%= 'checked' if @recipe_requirements[:skill_level] == 'Advanced' %>>
            <label class="btn btn-outline-soft-brown flex-grow-1" for="skill_advanced">Advanced</label>
          </div>
        </div>

        <div class="mb-4">
          <label class="form-label text-charcoal">Meal Type</label>

          <div class="btn-group d-flex flex-wrap" role="group" aria-label="Meal type selection">

            <input type="radio" class="btn-check" name="chat[recipe_requirements][meal_type]" id="meal_breakfast" value="Breakfast" autocomplete="off" <%= 'checked' if @recipe_requirements[:meal_type] == 'Breakfast' %>>
            <label class="btn btn-outline-soft-brown w-25" for="meal_breakfast">Breakfast</label>

            <%# Meal Type 2: Lunch %>
            <input type="radio" class="btn-check" name="chat[recipe_requirements][meal_type]" id="meal_lunch" value="Lunch" autocomplete="off" <%= 'checked' if @recipe_requirements[:meal_type] == 'Lunch' %>>
            <label class="btn btn-outline-soft-brown w-25" for="meal_lunch">Lunch</label>

            <%# Meal Type 3: Dinner %>
            <input type="radio" class="btn-check" name="chat[recipe_requirements][meal_type]" id="meal_dinner" value="Dinner" autocomplete="off" <%= 'checked' if @recipe_requirements[:meal_type] == 'Dinner' %>>
            <label class="btn btn-outline-soft-brown w-25" for="meal_dinner">Dinner</label>

            <%# Meal Type 4: Dessert %>
            <input type="radio" class="btn-check" name="chat[recipe_requirements][meal_type]" id="meal_dessert" value="Dessert" autocomplete="off" <%= 'checked' if @recipe_requirements[:meal_type] == 'Dessert' %>>
            <label class="btn btn-outline-soft-brown w-25" for="meal_dessert">Dessert</label>
          </div>
        </div>

        <%# --- Preparation Time Dropdown --- %>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
          <%= req.input :meal_prep_time,
              collection: [[10,10],[15,15],[20,20],[30,30],[45,45],["1hr +",60]],
              label: "Preparation Time",
              prompt: "Select preparation time",
              input_html: { class: "form-select" } %>
        </div>

        <%# --- Dietary Restrictions Textarea --- %>
        <%= req.input :restrictions,
            as: :text,
            label: "Dietary Restrictions or Notes",
            input_html: { rows: 4, class: "form-control" } %>

      </div>
    <% end %>

    <div class="mt-6">
      <%# Submit button styled with Accent Green %>
      <%= f.submit 'Generate Recipes!', class: 'btn btn-accent-green' %>
    </div>

  <% end %>

</div>

<%# Renders the Offcanvas Sidebar for chat history %>
<%= render 'shared/offcanvas' if user_signed_in? %>
