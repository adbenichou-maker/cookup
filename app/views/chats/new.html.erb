<div class="ai-cook-page">
  <!-- Header -->
  <div class="ai-cook-header">
    <%= link_to dashboard_path, class: "profile-back" do %>
      <i class="fa-solid fa-arrow-left"></i>
    <% end %>
    <a class="ai-cook-history-btn" href="#" data-bs-toggle="offcanvas" data-bs-target="#chatsOffcanvas" aria-controls="chatsOffcanvas">
      <i class="fa-solid fa-clock-rotate-left"></i>
      <span>History</span>
    </a>
  </div>

  <!-- Hero Section -->
  <div class="ai-cook-hero">
    <div class="ai-cook-icon-wrapper">
      <i class="fa-solid fa-wand-magic-sparkles"></i>
    </div>
    <h1 class="ai-cook-title">What's Cooking?</h1>
    <p class="ai-cook-subtitle">Tell your AI Chef about the dish you want to create</p>
  </div>

  <!-- Form Card -->
  <div class="ai-form-card">
    <%= simple_form_for @chat, url: chats_path, method: :post do |f| %>
      <%= f.simple_fields_for :recipe_requirements, @recipe_requirements do |req| %>
        <% meal_types = ['Breakfast', 'Lunch', 'Dinner', 'Dessert'] %>
        <% skill_levels = ['Beginner', 'Intermediate', 'Advanced'] %>

        <!-- Ingredients Section -->
        <div class="ai-form-section">
          <div class="ai-form-section-header">
            <div class="ai-form-section-icon">
              <i class="fa-solid fa-carrot"></i>
            </div>
            <div class="ai-form-section-label">
              <span class="ai-form-section-title">Key Ingredients</span>
              <span class="ai-form-section-hint">What do you have?</span>
            </div>
          </div>
          <%= req.input :ingredients,
            label: false,
            input_html: { class: "ai-form-input", placeholder: "e.g., chicken, basil, tomatoes..." } %>
        </div>

        <!-- Skill Level Section -->
        <div class="ai-form-section">
          <div class="ai-form-section-header">
            <div class="ai-form-section-icon">
              <i class="fa-solid fa-chart-simple"></i>
            </div>
            <div class="ai-form-section-label">
              <span class="ai-form-section-title">Skill Level</span>
              <span class="ai-form-section-hint">Your cooking experience</span>
            </div>
          </div>
          <div class="ai-toggle-group ai-toggle-3">
            <% skill_levels.each_with_index do |level, index| %>
              <% level_id = "skill_#{level.downcase}" %>
              <input type="radio"
                    class="ai-toggle-input"
                    name="chat[recipe_requirements][skill_level]"
                    id="<%= level_id %>"
                    value="<%= level %>"
                    autocomplete="off"
                    <%= 'checked' if @recipe_requirements[:skill_level] == level %>>
              <label class="ai-toggle-label" for="<%= level_id %>">
                <% if index == 0 %>
                  <i class="fa-solid fa-seedling"></i>
                <% elsif index == 1 %>
                  <i class="fa-solid fa-fire-flame-curved"></i>
                <% else %>
                  <i class="fa-solid fa-crown"></i>
                <% end %>
                <span><%= level %></span>
              </label>
            <% end %>
          </div>
        </div>

        <!-- Meal Type Section -->
        <div class="ai-form-section">
          <div class="ai-form-section-header">
            <div class="ai-form-section-icon">
              <i class="fa-solid fa-utensils"></i>
            </div>
            <div class="ai-form-section-label">
              <span class="ai-form-section-title">Meal Type</span>
              <span class="ai-form-section-hint">What are you making?</span>
            </div>
          </div>
          <div class="ai-toggle-group ai-toggle-4">
            <% meal_types.each_with_index do |type, index| %>
              <% type_id = "meal_#{type.downcase}" %>
              <input type="radio"
                    class="ai-toggle-input"
                    name="chat[recipe_requirements][meal_type]"
                    id="<%= type_id %>"
                    value="<%= type %>"
                    autocomplete="off"
                    <%= 'checked' if @recipe_requirements[:meal_type] == type %>>
              <label class="ai-toggle-label" for="<%= type_id %>">
                <% if index == 0 %>
                  <i class="fa-solid fa-sun"></i>
                <% elsif index == 1 %>
                  <i class="fa-solid fa-cloud-sun"></i>
                <% elsif index == 2 %>
                  <i class="fa-solid fa-moon"></i>
                <% else %>
                  <i class="fa-solid fa-cake-candles"></i>
                <% end %>
                <span><%= type %></span>
              </label>
            <% end %>
          </div>
        </div>

        <!-- Prep Time Section -->
        <div class="ai-form-section">
          <div class="ai-form-section-header">
            <div class="ai-form-section-icon">
              <i class="fa-solid fa-clock"></i>
            </div>
            <div class="ai-form-section-label">
              <span class="ai-form-section-title">Prep Time</span>
              <span class="ai-form-section-hint">How much time do you have?</span>
            </div>
          </div>

          <div data-controller="prepTime" class="ai-prep-time-container" id="prep-timer-ai">
            <div class="ai-prep-time-display" data-prepTime-target="label">
              <%= (@recipe_requirements[:meal_prep_time].to_i == 120 || @recipe_requirements[:meal_prep_time].blank?) ? "No limit" : "#{@recipe_requirements[:meal_prep_time]} min" %>
            </div>
            <input
              type="range"
              min="5"
              max="120"
              step="5"
              value="<%= @recipe_requirements[:meal_prep_time] || 120 %>"
              class="ai-prep-time-slider"
              data-action="input->prepTime#update"
              data-prepTime-target="slider"
            >
            <div class="ai-prep-time-labels">
              <span>5 min</span>
              <span>No limit</span>
            </div>
            <%= req.hidden_field :meal_prep_time,
                  value: @recipe_requirements[:meal_prep_time] || 120,
                  data: { prepTime_target: "input" } %>
          </div>
        </div>

        <!-- Dietary Restrictions Section -->
        <div class="ai-form-section">
          <div class="ai-form-section-header">
            <div class="ai-form-section-icon">
              <i class="fa-solid fa-leaf"></i>
            </div>
            <div class="ai-form-section-label">
              <span class="ai-form-section-title">Dietary Notes</span>
              <span class="ai-form-section-hint">Allergies, preferences, etc.</span>
            </div>
          </div>
          <%= req.input :restrictions,
              as: :text,
              label: false,
              input_html: { rows: 3, class: "ai-form-textarea", placeholder: "e.g., vegetarian, no nuts, low sodium..." } %>
        </div>

      <% end %>

      <!-- Submit Button -->
      <div class="ai-form-submit">
        <%= f.submit 'Generate Recipes', class: 'ai-submit-btn' %>
      </div>
    <% end %>
  </div>
</div>

<%= render 'shared/offcanvas' if user_signed_in? %>
